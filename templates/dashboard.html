{% extends 'layout.html' %}

{% block body %}
<h1>Profile settings</h1>
{% from "includes/_formhelpers.html" import render_field %}
<img src={{user["avatar"]}} alt="profile pic" style="width:128px;height:128x;">
  <div class="mt-3" id="deleteUser">
    <p class="btn btn-black" id="delBut">Delete Account</p>
  </div>
  <form action="" enctype="multipart/form-data" method="POST">
    <div class="form-group mt-3">
      <div class="custom-file">
        <input type="file" name="image" multiple="false" id="image" class="custom-file-input">
        <label id="labeled" class="custom-file-label" for="image">Select Image...</label>
      </div>
    </div>
    <button class="btn btn-black" type="submit">Upload</button>
  </form>
<script>
  var uname = "{{session['username']}}";
$('#deleteUser').on('click', () => {
  $.ajax({
    type: 'POST',
    url: `http://127.0.0.1:5000/api/user/delete?username=${uname}`,
    success: () => {
      location.replace('http://127.0.0.1:5000/login')
    }
  })
})

$('#image').on('change', (e) => {
    var label = document.getElementById('labeled');
    var fname = document.getElementById('image').files[0].name;
    label.innerHTML = fname;
  })
</script>
{% endblock %}